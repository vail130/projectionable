// Generated by CoffeeScript 1.3.3
(function() {

  $(function() {
    var $alert, $formBody, $password1, $password2, $signupButton, $signupEmail, $signupInputs, displayError, displaySuccess;
    $formBody = $('.signup-page .proj-form-body');
    $alert = $formBody.children('.alert');
    $signupInputs = $formBody.children('input');
    $signupEmail = $('#email');
    $password1 = $('#password1');
    $password2 = $('#password2');
    $signupButton = $formBody.find('.signup-button');
    $signupInputs.first().get(0).focus();
    $signupEmail.add($password1).add($password2).keypress(function(event) {
      var code;
      code = event.keyCode ? event.keyCode : event.charCode;
      if (code === 13) {
        return $signupButton.trigger('click');
      }
    });
    $signupButton.click(function(event) {
      var email, password1, password2,
        _this = this;
      event.preventDefault();
      email = $signupEmail.val();
      if (email === '') {
        displayError('Missing email field');
        $signupInputs.get(0).focus();
        return;
      }
      password1 = $password1.val();
      password2 = $password2.val();
      if (password1 === '') {
        displayError('Missing password field');
        $signupInputs.get(1).focus();
        return;
      } else if (password2 === '') {
        displayError('Missing password field');
        $signupInputs.get(2).focus();
        return;
      } else if (password1 !== password2) {
        displayError('Mismatching password fields');
        $signupInputs.get(1).focus();
        return;
      }
      $signupButton.button('loading');
      $alert.hide();
      return $.ajax({
        type: 'POST',
        dataType: 'json',
        contentType: 'application/json',
        url: '/api/accounts',
        data: JSON.stringify({
          email: email,
          password: password1
        }),
        success: function(json) {
          displaySuccess('Thank you! Please check your email to activate your account.');
          return $formBody.children().not('.alert').hide().filter('input').val('');
        },
        error: function(jqXHR) {
          try {
            displayError(_.pairs(JSON.parse(jqXHR.responseText))[0][1]);
          } catch (e) {
            displayError(jqXHR.statusText);
          }
          $signupInputs.get(0).focus();
          return $signupButton.button('reset');
        }
      });
    });
    displayError = function(msg) {
      return $alert.removeClass('alert-success').find('span').text(msg).end().addClass('alert-error').show();
    };
    return displaySuccess = function(msg) {
      return $alert.removeClass('alert-error').find('span').text(msg).end().addClass('alert-success').show();
    };
  });

}).call(this);
