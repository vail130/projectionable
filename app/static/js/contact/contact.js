// Generated by CoffeeScript 1.3.3
(function() {

  $(function() {
    var $alert, $formBody, $formInputs, $message, $replyTo, $subject, $submitButton, displayError, displaySuccess, focused;
    $formBody = $('.contact-form .proj-form-body');
    $formInputs = $formBody.find('> input');
    $alert = $formBody.find('> .alert');
    $replyTo = $('#reply-to');
    $subject = $('#subject');
    $message = $('#message');
    $submitButton = $formBody.find('.submit-button');
    focused = false;
    $formInputs.each(function() {
      if (!focused && this.value === '') {
        this.focus();
        return focused = true;
      }
    });
    $submitButton.click(function(event) {
      var message, replyTo, subject,
        _this = this;
      event.preventDefault();
      replyTo = $replyTo.val();
      if (replyTo === '') {
        displayError('Missing reply-to field');
        $formInputs.get(0).focus();
        return;
      }
      subject = $subject.val();
      if (subject === '') {
        displayError('Missing subject field');
        $formInputs.get(1).focus();
        return;
      }
      message = $message.val();
      if (message === '') {
        displayError('Missing message field');
        $formBody.find('textarea').get(0).focus();
        return;
      }
      $submitButton.button('loading');
      $alert.hide();
      return $.ajax({
        type: 'POST',
        dataType: 'json',
        contentType: 'application/json',
        url: '/api/contacts/',
        data: JSON.stringify({
          replyTo: replyTo,
          subject: subject,
          message: message
        }),
        success: function(json) {
          displaySuccess('Thank you for your contact.');
          return $formBody.children().not('.alert').hide().filter('input, textarea').val('');
        },
        error: function(jqXHR) {
          try {
            displayError(_.pairs(JSON.parse(jqXHR.responseText))[0][1]);
          } catch (e) {
            displayError(jqXHR.statusText);
          }
          $submitButton.button('reset');
          return $formInputs.get(0).focus();
        }
      });
    });
    displayError = function(msg) {
      return $alert.removeClass('alert-success').children('span').text(msg).end().addClass('alert-error').show();
    };
    return displaySuccess = function(msg) {
      return $alert.removeClass('alert-error').children('span').text(msg).end().addClass('alert-success').show();
    };
  });

}).call(this);
